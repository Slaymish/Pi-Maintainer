Certainly! Here’s a comprehensive summary of the **PiMainteno** project, distilled from source and configuration files:

---

## **PiMainteno – Comprehensive Project Summary**

---

### **Purpose**

**PiMainteno** is an autonomous, Rust-based maintenance agent for Git-managed projects and corresponding systemd services. It uses LLMs (via the external `codex` CLI) to periodically analyze, suggest, and apply code improvements—providing full observability and control through a web UI and API.

---

### **Major Features**

- **Always-On Automation**:  
  - Periodically (or on-demand) performs code summarization, minimal patch suggestion, patch application, commit, push, and triggers a systemd service restart for each configured project.

- **LLM-Driven Improvements**:  
  - All core code-improvement tasks are delegated to an external LLM CLI.
  - Summaries (`codex.md`), patch diffs, and commit messages are all generated by the LLM.

- **Web Dashboard & API**:  
  - Real-time dashboard for status, history, controls, and manual triggers.
  - Exposes JSON API for integration and scripting (`/api/status`, `/api/projects`, `/api/run`, etc.).

- **Efficient Caching**:  
  - sled-based database caches LLM outputs (summaries, patches, commit logs, error flags) keyed by project and Git HEAD to optimize for minimal API usage and avoid duplicated work.

- **Safe, Versioned Operations**:  
  - Only operates on Git repositories; changes are staged, committed, and pushed atomically.

- **Service Integration**:  
  - When code changes are committed/pushed, the matching systemd service (`<project-name>.service`) is automatically (re)started.

- **Systemd Monitoring (Stub)**:  
  - Designed to monitor systemd units for service failures and trigger repair workflows via LLM in the future.

---

### **Key Entry Points**

- **CLI / Daemon** (`src/main.rs`):  
  - Main entry for running in one-shot mode or as a daemon.
  - Loads config (`PiMainteno.toml`), sets up logging, launches the scheduler, optional web server, and systemd monitor.

- **Web API & Dashboard** (`src/web_server.rs`):  
  - Exposes HTTP endpoints and a control/visibility web dashboard.

- **Upload Script** (`upload_service.sh`):  
  - Builds, installs the binary and config, and restarts the systemd service.

---

### **Primary Files & Modules**

- **PiMainteno.toml**: Main configuration file—holds details for LLM, cache, scheduler, web server, and systemd unit monitoring.
- **src/config.rs**: Deserializes and loads all config sections.
- **src/cache.rs**: Handles sled DB caching for summaries, patches, etc.
- **src/codex_client.rs**: Talks to the `codex` CLI for LLM queries.
- **src/summarizer.rs**: Generates/updates the `codex.md` summary on HEAD change.
- **src/patcher.rs**: Gets minimal improvement patches, applies them (with LLM help), handles staging/committing/pushing in Git.
- **src/scheduler.rs**: Main orchestration for always-on and manual workflows.
- **src/systemd_monitor.rs**: (Stub) Watches systemd services for failure; future reactive repair.
- **src/web_server.rs**: Runs axum-based web dashboard/API.
- **cache/**: sled DB files.
- **codex.md**: Latest LLM summary per project, updated if HEAD moves.

---

### **Configuration Structure** (`PiMainteno.toml`)

- `[llm]`: Provider, API key.
- `[cache]`: sled DB path.
- `[scheduler]`: Enable flag, cron interval, project list.
- `[systemd_monitor]`: Enable flag, list of monitored systemd units.
- `[web]`: Web server host/port.

---

### **Scheduled Maintenance Workflow**

1. For each project on each interval/trigger:
   1. If HEAD changed: update `codex.md` via LLM.
   2. Ask LLM for a minimal, atomic improvement patch.
   3. If patch:
      - Post-process, ask LLM to rebase/apply.
      - Write, stage, commit (`git commit -m` with LLM-generated message).
      - Push.
      - `systemctl restart <project>.service`.
2. Cache all LLM outputs keyed by project + HEAD.

**Manual run** possible any time through web UI or API.

---

### **API/Endpoint Overview**

- **GET /api/status**: Agent/system status
- **GET /api/projects**: List all projects/config status
- **GET /api/projects/:id/summary**: Get project summary
- **POST /api/run**: Manually trigger maintenance run

---

### **Technology Stack**

- **Rust**: Tokio async runtime, Axum/Tower for web, sled for DB.
- **LLM**: External `codex` CLI spawn for LLM tasks.
- **Git, systemctl**: Used for VCS and service restarts.

---

### **Extensibility & Roadmap**

- **Reactive systemd monitoring** (planned/future)
- **Emergency repair workflow** (planned)
- **Observable, safe, and autonomous**
- Built for in-place, continual, minimal changes (aims to be low-risk)

---

## **In One Sentence**

> **PiMainteno autonomously maintains, improves, and manages Git-based projects and their services using LLMs, offering safe, efficient, observable, and fully controllable continuous maintenance.**

---

**If you need info on a specific file, module, config, or API, let me know!**